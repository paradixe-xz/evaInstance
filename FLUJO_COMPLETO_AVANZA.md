# ğŸš€ Flujo Completo AVANZA - WhatsApp + IA + Llamadas + Documentos

## ğŸ“‹ Resumen del Nuevo Flujo

**Flujo implementado:**

1. **ğŸ“± Mensaje inicial WhatsApp** â†’ Usuario recibe presentaciÃ³n
2. **ğŸ¤– IA convence** â†’ Si dice "NO", IA lo convence
3. **ğŸ“ Llamada telefÃ³nica** â†’ Si acepta, se programa llamada
4. **ğŸ¯ VerificaciÃ³n post-llamada** â†’ Pregunta si se interesÃ³
5. **ğŸ“„ Solicitud de documentos** â†’ CÃ©dula y recibo de pago
6. **âœ… VerificaciÃ³n de nombres** â†’ Compara nombres en documentos
7. **ğŸ“§ EnvÃ­o por correo** â†’ Si coinciden, envÃ­a por email

---

## ğŸ”„ Flujo Detallado por Etapas

### **ETAPA 1: Mensaje Inicial**
```
ğŸ§ Â¡Hola Juan! Soy ANA de AVANZA ğŸ’¼

No te estoy escribiendo para venderte un crÃ©dito â€”te lo prometoâ€”, sino para ayudarte a organizar tus finanzas, que es algo que todos necesitamos hoy en dÃ­a.

ğŸ“Œ Tenemos tasas desde solo **1.6% mensual** por libranza
ğŸ“Œ Montos hasta $150 millones sin codeudor
ğŸ“Œ Sin importar si estÃ¡s reportado en centrales
ğŸ“Œ Descuento directo de nÃ³mina

Â¿Puedo llamarte para explicÃ¡rtelo? No es una llamada comercial, es una charla entre tÃº y yo buscando la mejor forma de que el dinero te rinda mÃ¡s sin estrÃ©s.

Â¿QuÃ© prefieres? ğŸ’°ğŸ’ª
```

### **ETAPA 2: Respuesta del Usuario**

#### **Si dice "SÃ":**
```
âœ… Â¡Excelente Juan! 

Tu llamada estÃ¡ programada. Te llamarÃ© puntualmente para revisar tu elegibilidad y explicarte todos los beneficios del prÃ©stamo AVANZA.

ğŸ“‹ En la llamada de 10 minutos revisaremos:
â€¢ Tu situaciÃ³n actual y capacidad de pago
â€¢ CÃ³mo podemos bajarte esa cuota que te tiene apretado
â€¢ Monto que puedes obtener (hasta $150 millones)
â€¢ DocumentaciÃ³n necesaria (solo cÃ©dula vigente)
â€¢ Proceso de desembolso (24-48 horas)

ğŸ“ Llamada programada. Te llamarÃ© en 1 minuto.
```

#### **Si dice "NO":**
```
Entiendo tu preocupaciÃ³n Juan, pero dÃ©jame explicarte algo importante:

Â¿SabÃ­as que con nuestros prÃ©stamos puedes:
â€¢ Reducir tus cuotas mensuales hasta en un 40%
â€¢ Recibir hasta $150 millones sin codeudor
â€¢ Tener descuento directo por nÃ³mina (sin olvidos)
â€¢ AprobaciÃ³n en 24-48 horas

Muchos de nuestros clientes han logrado ahorrar mÃ¡s de $500,000 mensuales. Â¿Te parece que vale la pena que te explique cÃ³mo? Solo necesito 5 minutos de tu tiempo.

Â¿Me das esa oportunidad? ğŸ’°
```

### **ETAPA 3: ConversaciÃ³n Persuasiva**
Si el usuario sigue diciendo "NO", la IA continÃºa convenciendo:

```
Entiendo Juan, pero dÃ©jame contarte algo:

MarÃ­a, una docente como tÃº, logrÃ³ reducir su cuota de $800,000 a $450,000 mensuales. Eso significa $350,000 mÃ¡s en su bolsillo cada mes.

Â¿Te imaginas quÃ© podrÃ­as hacer con ese dinero extra? Pagar deudas, ahorrar, o simplemente vivir mÃ¡s tranquila.

Â¿Vale la pena que te explique cÃ³mo? Solo 5 minutos. ğŸ’°
```

### **ETAPA 4: Llamada TelefÃ³nica**
- **Sistema llama automÃ¡ticamente**
- **Ana habla con IA** (guion de 10 minutos)
- **TranscripciÃ³n completa** de la conversaciÃ³n
- **AnÃ¡lisis automÃ¡tico** con IA

### **ETAPA 5: VerificaciÃ³n Post-Llamada**
DespuÃ©s de la llamada, el sistema pregunta:

```
ğŸ‰ Â¡Excelente Juan! 

Perfecto, para continuar con tu solicitud necesito que me envÃ­es estos documentos:

ğŸ“‹ Documentos requeridos:
1. ğŸ“„ CÃ©dula de ciudadanÃ­a (frente y reverso)
2. ğŸ’° Ãšltimo recibo de pago de nÃ³mina
3. ğŸ“ Formato de autorizaciÃ³n (te lo envÃ­o ahora)

ğŸ“± EnvÃ­alos por WhatsApp a este mismo nÃºmero
ğŸ“§ O por email a: info@avanza.lat

Â¿Tienes estos documentos a la mano? ğŸ“„
```

### **ETAPA 6: RecepciÃ³n de Documentos**
El usuario envÃ­a los documentos y el sistema:

1. **Verifica nombres** â†’ Compara nombre en cÃ©dula vs recibo
2. **Si coinciden** â†’ EnvÃ­a por correo electrÃ³nico
3. **Si no coinciden** â†’ Pide correcciÃ³n

#### **Respuesta si coinciden:**
```
âœ… Â¡Perfecto Juan! 

He verificado tus documentos y los nombres coinciden perfectamente.

ğŸ“§ He enviado tus documentos por correo electrÃ³nico.

ğŸ“‹ PrÃ³ximos pasos:
1. âœ… Documentos verificados
2. ğŸ“Š EvaluaciÃ³n financiera en proceso
3. ğŸ“ ConfirmaciÃ³n de aprobaciÃ³n (24-48 horas)
4. ğŸ’° Desembolso directo a tu cuenta

Te mantendrÃ© informado del proceso. Â¡Gracias por confiar en AVANZA! ğŸ‰
```

#### **Respuesta si NO coinciden:**
```
âŒ Juan, he detectado una diferencia en los nombres de los documentos.

Por favor verifica que:
â€¢ El nombre en la cÃ©dula sea exactamente igual al del recibo de pago
â€¢ Los documentos estÃ©n legibles y completos

Una vez corregido, envÃ­alos nuevamente. ğŸ“„
```

---

## ğŸ¯ Estados de ConversaciÃ³n Implementados

| Estado | DescripciÃ³n | AcciÃ³n del Sistema |
|--------|-------------|-------------------|
| `initial` | Primer contacto | EnvÃ­a mensaje de bienvenida |
| `waiting_confirmation` | Esperando respuesta | Procesa "SÃ/NO" |
| `convincing` | Usuario dijo "NO" | IA lo convence |
| `scheduled_call` | Llamada programada | Inicia llamada automÃ¡tica |
| `call_completed` | Llamada terminada | Pregunta si se interesÃ³ |
| `waiting_documents` | Esperando documentos | Solicita cÃ©dula y recibo |
| `documents_received` | Documentos recibidos | Procesa documentos |
| `documents_verified` | Documentos verificados | EnvÃ­a por correo |
| `not_interested` | No interesado | Ofrece promociones |

---

## ğŸ”§ Endpoints Implementados

### **EnvÃ­o Combinado (WhatsApp + Llamada)**
```bash
POST /sendNumbers
# EnvÃ­a WhatsApp + programa llamada
```

### **Solo WhatsApp**
```bash
POST /sendWhatsAppOnly
# Solo envÃ­a mensajes WhatsApp
```

### **Webhook (RecepciÃ³n AutomÃ¡tica)**
```bash
POST /whatsapp/business/webhook
# Recibe mensajes y responde automÃ¡ticamente
```

### **Procesamiento de Documentos**
```bash
POST /whatsapp/documents
# Recibe y verifica documentos
```

---

## ğŸ“Š Variables de Entorno Necesarias

```bash
# WhatsApp Business API
WHATSAPP_ACCESS_TOKEN=tu_access_token_aqui
WHATSAPP_PHONE_NUMBER_ID=tu_phone_number_id_aqui
WHATSAPP_BUSINESS_ACCOUNT_ID=tu_business_account_id_aqui
WHATSAPP_VERIFY_TOKEN=tu_verify_token_aqui
WHATSAPP_WEBHOOK_SECRET=tu_webhook_secret_aqui

# Twilio (para llamadas)
TWILIO_ACCOUNT_SID=tu_account_sid
TWILIO_AUTH_TOKEN=tu_auth_token
TWILIO_PHONE_NUMBER=tu_phone_number
TWILIO_WEBHOOK_URL=tu_webhook_url

# ElevenLabs (para audio)
ELEVENLABS_API_KEY=tu_api_key
ELEVENLABS_VOICE_ID=21m00Tcm4TlvDq8ikWAM

# Email (para envÃ­o de documentos)
EMAIL_SMTP_SERVER=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=tu_email@gmail.com
EMAIL_PASSWORD=tu_password_app
```

---

## ğŸ¯ **Ventajas del Nuevo Flujo**

1. **âœ… PersuasiÃ³n inteligente** - IA convence si dice "NO"
2. **âœ… Doble canal** - WhatsApp + llamada telefÃ³nica
3. **âœ… VerificaciÃ³n automÃ¡tica** - Compara nombres en documentos
4. **âœ… EnvÃ­o por correo** - AutomÃ¡tico si coinciden
5. **âœ… Seguimiento completo** - Todo el proceso registrado
6. **âœ… Menos intrusivo** - Usuario decide cuÃ¡ndo llamar
7. **âœ… ConversaciÃ³n natural** - IA responde en tiempo real

---

## ğŸš€ **Para Usar:**

1. **Configura las variables de entorno** en tu `.env`
2. **Sube archivo Excel** con contactos (`/sendNumbers`)
3. **Sistema envÃ­a WhatsApp** automÃ¡ticamente
4. **IA convence** si es necesario
5. **Llamada telefÃ³nica** si acepta
6. **Solicita documentos** post-llamada
7. **Verifica y envÃ­a** por correo

**Â¡El flujo completo estÃ¡ implementado y funcionando!** ğŸ‰ 